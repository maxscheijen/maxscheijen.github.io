<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="index, follow" />
  <title>VPS 101 - Setup & Security - Max Scheijen</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <link rel="stylesheet" href="../../theme/css/main.css" type="text/css" />
  <link rel="stylesheet" href="../../theme/css/syntax.css" type="text/css" />
  <link rel="icon" type="image/x-icon" href="../../theme/images/favicon/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="../../theme/images/favicon/favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="../../theme/images/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="192x192" href="../../theme/images/favicon/android-chrome-192x192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="../../theme/images/favicon/android-chrome-512x512.png">
  <link rel="apple-touch-icon" type="image/png" sizes="512x512" href="../../theme/images/favicon/apple-touch-icon.png">
  
  <link href="../../feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Max Scheijen - Flux ATOM" />
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-DC0740CRYY"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', "G-DC0740CRYY");
  </script>
</head>
<body>
  <main>
        
  <h1>VPS 101 - Setup & Security</h1>
  <a href="/" class="by">Sep 13, 2024 - By Max Scheijen</a>
  <div class="meta">
    <!-- <p>Sep 13, 2024</p> -->
    <!-- <p></p> -->
  </div>
  <article>
  <p>Recently, I developed an interest in hosting my own servers, which led me to explore virtual private servers (VPS).</p>
<p>This is the first part of my journey into hosting a Linux server.</p>
<ol>
<li><strong><a href="/posts/vps-101-setup-and-security">Setup &amp; Security</a></strong></li>
</ol>
<p>To experiment with hosting my own Linux VPS, I opted for the cheapest <a href="https://www.digitalocean.com/products/droplets">DigitalOcean Droplet</a>, priced as 4$ per month. I chose this primarily for its ease of use and affordability. It suits my needs, there are maybe other providers that offer similar services (at lower costs), but I'm fine with that.</p>
<h2>Connect to VPS with SSH.</h2>
<p>Your VPS provider will either guide you through setting up or automatically configure an SSH key or password, a (root) user, and an IP address, enabling you to connect to your VPS via SSH.</p>
<p>You can use this setup to establish your initial connection to the VPS. In my case the <code>&lt;user&gt;</code> was <code>root</code>.</p>
<div class="codehilite"><pre><span></span><code>ssh<span class="w"> </span>&lt;user&gt;@&lt;ip&gt;
</code></pre></div>

<h2>Updates</h2>
<p>The first step is to update the packages on your VPS, as they may be outdated and could pose security vulnerabilities.</p>
<p>To update packages on an Ubuntu machine, run the following commands:</p>
<div class="codehilite"><pre><span></span><code>sudo<span class="w"> </span>apt<span class="w"> </span>update
sudo<span class="w"> </span>apt<span class="w"> </span>upgrade<span class="w"> </span>-y
</code></pre></div>

<p>All packages should now be up to date. If any packages remain outdated, you may need to update them manually using the following command:</p>
<div class="codehilite"><pre><span></span><code>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>&lt;package-name&gt;
</code></pre></div>

<p>After updating the packages, you may need to reboot the machine. Use the following command to check if a reboot is required:</p>
<div class="codehilite"><pre><span></span><code>ls<span class="w"> </span>/var/run/reboot-required
</code></pre></div>

<p>if this file exists, a reboot is required, restart your VPS.</p>
<div class="codehilite"><pre><span></span><code>reboot
</code></pre></div>

<h3>Automatic Updates</h3>
<p>To ensure packages are automatically kept up to date, install the unattended-upgrades package.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># install unattended upgrades</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>unattended-upgrades

<span class="c1"># start unattended upgrades</span>
sudo<span class="w"> </span>dpkg-reconfigure<span class="w"> </span>unattended-upgrades
</code></pre></div>

<blockquote>
<p>You will likely be prompted to enable automatic package upgrades. If the prompt does not appear, you can configure it manually.</p>
<p>To configure unattended-upgrades, open the following file:</p>
<p><code>sh
sudo vim /etc/apt.conf.d/50unattended-upgrades</code></p>
<p>and un-comment the following line</p>
<p><code>sh
"${distro_id}:${distro_codename}-updates"</code></p>
</blockquote>
<p>To check if unattended-upgrades is running, use the systemctl command.</p>
<div class="codehilite"><pre><span></span><code>sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>unattended-upgrades
</code></pre></div>

<h2>Root and Users</h2>
<p>Your VPS provider will set you up with a user (likely root) and a password. It's good practice to change this password if it was generated by the provider.</p>
<p>To change the root password, use the passwd command while logged in as root.</p>
<div class="codehilite"><pre><span></span><code>passwd
</code></pre></div>

<p>It’s also good practice not to use the <code>root</code> user for everyday tasks. Instead, create a non-root user using the <code>adduser</code> command.</p>
<div class="codehilite"><pre><span></span><code>adduser<span class="w"> </span>&lt;username&gt;
</code></pre></div>

<p>You’ll be prompted to enter a password and some additional information for the new user.</p>
<p>To grant this user <code>sudo</code> (superuser) privileges, add them to the <code>sudo</code> group.</p>
<div class="codehilite"><pre><span></span><code>usermod<span class="w"> </span>-aG<span class="w"> </span>sudo<span class="w"> </span>&lt;username&gt;
</code></pre></div>

<p>To verify if the user has been successfully added to the sudo group:</p>
<div class="codehilite"><pre><span></span><code>groups<span class="w"> </span>&lt;username&gt;
</code></pre></div>

<p>This command should confirm that <code>&lt;username&gt;</code> is part of the <code>sudo</code> group:</p>
<div class="codehilite"><pre><span></span><code>&lt;username&gt; : &lt;username&gt; sudo users
</code></pre></div>

<p>You can now <code>exit</code> and attempt to log in as <code>&lt;username&gt;</code>:</p>
<div class="codehilite"><pre><span></span><code>ssh<span class="w"> </span>&lt;username&gt;@&lt;ip&gt;
</code></pre></div>

<p>You will be prompted to enter the password you just provided.</p>
<h2>Login with SSH</h2>
<p>Passwords can be less secure, so its recommend to use a SSH key for logging into your server.</p>
<p>First, generate an SSH key on your local machine if you don’t already have one:</p>
<div class="codehilite"><pre><span></span><code>ssh-keygen<span class="w"> </span>-t<span class="w"> </span>ed25519<span class="w"> </span>-C<span class="w"> </span><span class="s2">&quot;&lt;your_email@example.com&gt;&quot;</span>
</code></pre></div>

<p>Look for the <code>.pub</code> file in your <code>~/.ssh/ directory</code>, such as <code>~/.ssh/id_ed25519.pub</code>. This public key needs to be copied and added to your VPS.</p>
<p>On your VPS, create the <code>~/.ssh/</code> directory if it doesn’t already exist:</p>
<div class="codehilite"><pre><span></span><code>mkdir<span class="w"> </span>-p<span class="w"> </span>~/.ssh
</code></pre></div>

<p>Create an <code>~/.ssh/authorized_keys</code> file and add the <strong>public key (.pub)</strong> you generated on your local machine to this file. Save the changes.</p>
<div class="codehilite"><pre><span></span><code>ssh-copy-id<span class="w"> </span>&lt;username&gt;@&lt;ip&gt;
</code></pre></div>

<p><code>exit</code> the ssh session on your vps and try to login again.</p>
<div class="codehilite"><pre><span></span><code>ssh<span class="w"> </span>&lt;user&gt;@&lt;ip&gt;
</code></pre></div>

<p>If everything is configured correctly, you should not be prompted for a password.</p>
<h2>Disable Passwords and Root Login</h2>
<p>For improved security, it’s best to disable both password authentication and root login.</p>
<h3>Disable Password Authentication</h3>
<p>Open the <code>sshd_config</code> file:</p>
<div class="codehilite"><pre><span></span><code>sudo<span class="w"> </span>vim<span class="w"> </span>/etc/ssh/sshd_config
</code></pre></div>

<p>Ensure the following settings are present or otherwise change them:</p>
<div class="codehilite"><pre><span></span><code>PubkeyAuthentication<span class="w"> </span>yes
PasswordAuthentication<span class="w"> </span>no
</code></pre></div>

<blockquote>
<p>Depending on your VPS provider, there may be additional files that enable password authentication, such as <code>/etc/ssh/sshd_config.d/50-cloud-init.conf</code>. Make sure to update these files as well.</p>
</blockquote>
<p>Restart the SSH service for the changes to take effect:</p>
<div class="codehilite"><pre><span></span><code>sudo<span class="w"> </span>service<span class="w"> </span>ssh<span class="w"> </span>restart
</code></pre></div>

<p>To verify that password authentication is disabled, try logging in as the root user:</p>
<div class="codehilite"><pre><span></span><code>ssh<span class="w"> </span>root@&lt;ip&gt;
</code></pre></div>

<p>You should receive a permission denied error if the configuration is correct.</p>
<h3>Disable Root Login</h3>
<p>Open the same <code>sshd_config</code> file:</p>
<div class="codehilite"><pre><span></span><code>sudo<span class="w"> </span>vim<span class="w"> </span>/etc/ssh/sshd_config
</code></pre></div>

<p>Locate and update the following line:</p>
<div class="codehilite"><pre><span></span><code>PermitRootLogin<span class="w"> </span>no
</code></pre></div>

<p>Restart the SSH service again:</p>
<div class="codehilite"><pre><span></span><code>sudo<span class="w"> </span>service<span class="w"> </span>ssh<span class="w"> </span>restart
</code></pre></div>

<h2>Network and Firewall</h2>
<p>The firewall’s purpose is to only allow the ports on your VPS that you actually use. Commonly used ports include:</p>
<ul>
<li><code>22</code> for SSH</li>
<li><code>80</code> for HTTP</li>
<li><code>443</code> for HTTPS</li>
</ul>
<p>Some VPS providers allow you to manage ports through their dashboard or UI. However, you can also use <a href="https://manpages.ubuntu.com/manpages/bionic/en/man8/ufw.8.html"><code>ufw</code></a> (Uncomplicated Firewall), which is simple to use and typically installed by default on Ubuntu.</p>
<p>Run the following commands to configure <code>ufw</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Disable all incoming connections by default</span>
sudo<span class="w"> </span>ufw<span class="w"> </span>default<span class="w"> </span>deny<span class="w"> </span>incoming

<span class="c1"># Allow all outgoing connections by default</span>
sudo<span class="w"> </span>ufw<span class="w"> </span>default<span class="w"> </span>allow<span class="w"> </span>outgoing

<span class="c1"># IMPORTANT: Allow incoming connections for SSH before enabling the firewall</span>
sudo<span class="w"> </span>ufw<span class="w"> </span>allow<span class="w"> </span>OpenSSH

<span class="c1"># Check the current rules to ensure they are correct</span>
sudo<span class="w"> </span>ufw<span class="w"> </span>show<span class="w"> </span>added

<span class="c1"># Enable the firewall</span>
sudo<span class="w"> </span>ufw<span class="w"> </span><span class="nb">enable</span>
</code></pre></div>

<p>With these settings, all ports will be blocked except port <code>22</code> for SSH.</p>
<blockquote>
<p>Note: Exposing a port with Docker may overwrite IP rules set by <code>ufw</code>. Instead of defining ports in a Docker Compose file, consider setting up a reverse proxy to manage access to ports <code>80</code> and/or <code>443</code>.</p>
</blockquote>
<h2>Links</h2>
<p>[[vps]] [[ssh]] [[linux]] [[security]]</p>
  </article>
  </main>
</body>
</html>